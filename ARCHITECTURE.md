# ğŸ—ï¸ NutriGuide å¾®æœåŠ¡æ¶æ„è®¾è®¡

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

NutriGuide é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå°†åŠŸèƒ½æ¨¡å—åŒ–ä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œæä¾›é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ”§ æŠ€æœ¯é€‰å‹å¯¹æ¯”

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | æ›¿ä»£æ–¹æ¡ˆ | é€‰æ‹©ç†ç”± |
|------|----------|----------|----------|
| **Backend API** | NestJS + TypeScript | Express.js, Fastify | ä¼ä¸šçº§æ¡†æ¶ï¼Œè£…é¥°å™¨æ”¯æŒï¼Œå†…ç½®ä¾èµ–æ³¨å…¥ |
| **PDF Parser** | Python + FastAPI | Node.js, Go | ä¸°å¯Œçš„PDFå¤„ç†åº“ï¼ŒAI/MLç”Ÿæ€ |
| **æ•°æ®åº“** | MongoDB | PostgreSQL, MySQL | æ–‡æ¡£å‹å­˜å‚¨ï¼Œé€‚åˆè¥å…»æ•°æ®çš„å¤æ‚ç»“æ„ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | Redis + Celery | RabbitMQ, Apache Kafka | è½»é‡çº§ï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„ |
| **å®¹å™¨åŒ–** | Docker + Compose | Kubernetes | ç®€åŒ–å¼€å‘ç¯å¢ƒï¼Œæ˜“äºéƒ¨ç½² |

## ğŸŒ æœåŠ¡é—´é€šä¿¡æ¶æ„

```mermaid
graph TB
    subgraph "Client Layer"
        A[Mobile App]
        B[iOS App]
        C[Web Dashboard]
    end

    subgraph "API Gateway"
        D[Nginx Load Balancer]
    end

    subgraph "Application Layer"
        E[Backend API<br/>NestJS]
        F[PDF Parser Service<br/>FastAPI]
    end

    subgraph "Processing Layer"
        G[Celery Workers]
        H[Background Tasks]
    end

    subgraph "Data Layer"
        I[MongoDB<br/>Primary Database]
        J[Redis<br/>Cache & Queue]
    end

    subgraph "Storage Layer"
        K[File Storage<br/>PDF Files]
        L[Logs<br/>Application Logs]
    end

    A --> D
    B --> D
    C --> D
    D --> E
    D --> F
    E --> I
    E --> J
    F --> I
    F --> J
    F --> G
    G --> H
    G --> I
    F --> K
    E --> L
    F --> L
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### 1. PDFè§£ææµç¨‹

```mermaid
sequenceDiagram
    participant U as User/App
    participant B as Backend API
    participant R as Redis Queue
    participant P as PDF Parser
    participant W as Celery Worker
    participant DB as MongoDB

    U->>B: ä¸Šä¼ PDFæ–‡ä»¶
    B->>R: å‘é€è§£æä»»åŠ¡
    B->>U: è¿”å›ä»»åŠ¡ID
    
    R->>W: åˆ†å‘ä»»åŠ¡
    W->>P: è°ƒç”¨è§£ææœåŠ¡
    P->>P: è§£æPDFå†…å®¹
    P->>DB: ä¿å­˜è§£æç»“æœ
    
    U->>B: æŸ¥è¯¢è§£æçŠ¶æ€
    B->>DB: è·å–ç»“æœ
    B->>U: è¿”å›è§£ææ•°æ®
```

### 2. æ•°æ®åŒæ­¥æœºåˆ¶

- **å®æ—¶åŒæ­¥**: å°æ–‡ä»¶(<5MB) åŒæ­¥å¤„ç†
- **å¼‚æ­¥é˜Ÿåˆ—**: å¤§æ–‡ä»¶é€šè¿‡Celeryé˜Ÿåˆ—å¤„ç†
- **çŠ¶æ€è¿½è¸ª**: Rediså­˜å‚¨å¤„ç†çŠ¶æ€
- **ç»“æœç¼“å­˜**: è§£æç»“æœç¼“å­˜30å¤©

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æˆæƒ

```mermaid
graph LR
    A[Client Request] --> B[API Gateway]
    B --> C{JWT Token Valid?}
    C -->|Yes| D[Route to Service]
    C -->|No| E[Return 401]
    D --> F[Service Authorization]
    F --> G[Business Logic]
```

### å®‰å…¨æªæ–½

1. **APIå±‚é¢**
   - JWT tokenè®¤è¯
   - Rate limiting
   - CORSé…ç½®
   - Input validation

2. **æœåŠ¡å±‚é¢**
   - æœåŠ¡é—´é€šä¿¡åŠ å¯†
   - æ–‡ä»¶ä¸Šä¼ é™åˆ¶
   - æ¶æ„æ–‡ä»¶æ£€æµ‹

3. **æ•°æ®å±‚é¢**
   - æ•°æ®åº“è¿æ¥åŠ å¯†
   - æ•æ„Ÿæ•°æ®è„±æ•
   - å®šæœŸå¤‡ä»½

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```yaml
# ç”Ÿäº§ç¯å¢ƒæ‰©å±•é…ç½®
services:
  backend:
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  pdf-parser:
    deploy:
      replicas: 2
      
  pdf-worker:
    deploy:
      replicas: 5  # æ ¹æ®å¤„ç†é‡è°ƒæ•´
```

### è´Ÿè½½å‡è¡¡ç­–ç•¥

- **Backend API**: Round-robinè´Ÿè½½å‡è¡¡
- **PDF Workers**: é˜Ÿåˆ—è‡ªåŠ¨åˆ†å‘
- **æ•°æ®åº“**: è¯»å†™åˆ†ç¦» (æœªæ¥)

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ (dev)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Development               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å•æœºéƒ¨ç½²                           â”‚
â”‚ â€¢ æºç æŒ‚è½½çƒ­é‡è½½                      â”‚
â”‚ â€¢ è¯¦ç»†æ—¥å¿—è¾“å‡º                       â”‚
â”‚ â€¢ MongoDB Admin UI                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•ç¯å¢ƒ (qa)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QA Testing             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”Ÿäº§æ¨¡å¼æ„å»º                       â”‚
â”‚ â€¢ èµ„æºé™åˆ¶                          â”‚
â”‚ â€¢ æ€§èƒ½ç›‘æ§                          â”‚
â”‚ â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§ç¯å¢ƒ (prod)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Production               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å¤šå®ä¾‹éƒ¨ç½²                        â”‚
â”‚ â€¢ Nginxè´Ÿè½½å‡è¡¡                     â”‚
â”‚ â€¢ SSL/TLSåŠ å¯†                       â”‚
â”‚ â€¢ ç›‘æ§å‘Šè­¦                          â”‚
â”‚ â€¢ è‡ªåŠ¨é‡å¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

1. **åº”ç”¨å±‚ç¼“å­˜**
   - Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
   - è§£æç»“æœç¼“å­˜
   - ç”¨æˆ·ä¼šè¯ç¼“å­˜

2. **æ•°æ®åº“ä¼˜åŒ–**
   - ç´¢å¼•ä¼˜åŒ–
   - æŸ¥è¯¢ä¼˜åŒ–
   - è¿æ¥æ± é…ç½®

3. **æ–‡ä»¶å¤„ç†ä¼˜åŒ–**
   - åˆ†å—ä¸Šä¼ 
   - å‹ç¼©ä¼ è¾“
   - CDNåŠ é€Ÿ

### ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | ç›‘æ§é¡¹ | é˜ˆå€¼ |
|----------|--------|------|
| **ç³»ç»Ÿæ€§èƒ½** | CPUä½¿ç”¨ç‡ | <80% |
| **å†…å­˜ä½¿ç”¨** | å†…å­˜å ç”¨ | <85% |
| **ç½‘ç»œ** | å“åº”æ—¶é—´ | <500ms |
| **é˜Ÿåˆ—** | ä»»åŠ¡ç§¯å‹ | <100 |
| **é”™è¯¯ç‡** | 5xxé”™è¯¯ | <1% |

## ğŸ”§ è¿ç»´æŒ‡å—

### æ—¥å¸¸ç»´æŠ¤

```bash
# æœåŠ¡çŠ¶æ€æ£€æŸ¥
./scripts/status.sh

# æ—¥å¿—æŸ¥çœ‹
docker-compose logs -f --tail=100 pdf-parser-prod

# æ€§èƒ½ç›‘æ§
docker stats

# æ¸…ç†æ— ç”¨èµ„æº
./scripts/cleanup.sh
```

### æ•…éšœæ¢å¤

1. **æœåŠ¡é‡å¯**
   ```bash
   # é‡å¯ç‰¹å®šæœåŠ¡
   docker-compose restart pdf-parser-prod
   ```

2. **æ•°æ®å¤‡ä»½æ¢å¤**
   ```bash
   # æ•°æ®åº“å¤‡ä»½
   docker exec mongodb-prod mongodump --out=/backup
   
   # æ•°æ®æ¢å¤
   docker exec mongodb-prod mongorestore /backup
   ```

3. **æ‰©å®¹å¤„ç†**
   ```bash
   # ä¸´æ—¶æ‰©å®¹worker
   docker-compose up --scale pdf-worker-prod=10 -d
   ```

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡ (1-3ä¸ªæœˆ)

- [ ] å¢åŠ æ›´å¤šPDFè§£æç®—æ³•
- [ ] å®ç°AIè¾…åŠ©æ•°æ®æå–
- [ ] æ·»åŠ æ‰¹é‡å¤„ç†åŠŸèƒ½
- [ ] å®Œå–„ç›‘æ§å’Œå‘Šè­¦

### ä¸­æœŸç›®æ ‡ (3-6ä¸ªæœˆ)

- [ ] å¾®æœåŠ¡ç½‘æ ¼ (Service Mesh)
- [ ] åˆ†å¸ƒå¼è¿½è¸ª (Distributed Tracing)
- [ ] è‡ªåŠ¨åŒ–CI/CD
- [ ] å¤šè¯­è¨€æ”¯æŒ

### é•¿æœŸç›®æ ‡ (6-12ä¸ªæœˆ)

- [ ] Kuberneteséƒ¨ç½²
- [ ] å¤šåŒºåŸŸéƒ¨ç½²
- [ ] æœºå™¨å­¦ä¹ æ¨¡å‹é›†æˆ
- [ ] å®æ—¶æ•°æ®åˆ†æ

## ğŸ“š æŠ€æœ¯å€ºåŠ¡

### å½“å‰å·²çŸ¥é—®é¢˜

1. **æ€§èƒ½ä¼˜åŒ–**
   - PDFè§£æé€Ÿåº¦æœ‰å¾…æå‡
   - å¤§æ–‡ä»¶å¤„ç†å†…å­˜å ç”¨è¾ƒé«˜

2. **ç›‘æ§å®Œå–„**
   - ç¼ºå°‘åˆ†å¸ƒå¼è¿½è¸ª
   - å‘Šè­¦æœºåˆ¶éœ€è¦å®Œå–„

3. **æµ‹è¯•è¦†ç›–**
   - é›†æˆæµ‹è¯•è¦†ç›–ç‡ä¸è¶³
   - æ€§èƒ½æµ‹è¯•å¾…è¡¥å……

### è§£å†³è®¡åˆ’

- Q1: æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§å®Œå–„
- Q2: æµ‹è¯•è¦†ç›–ç‡æå‡
- Q3: æ¶æ„é‡æ„å’Œä¼˜åŒ–

---

## ğŸ“ è”ç³»æ–¹å¼

- **æ¶æ„å¸ˆ**: architecture@nutriguide.com
- **DevOps**: devops@nutriguide.com
- **æŠ€æœ¯æ”¯æŒ**: tech-support@nutriguide.com 