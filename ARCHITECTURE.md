# ğŸ—ï¸ NutriGuide å¾®æœåŠ¡æ¶æ„è®¾è®¡

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

NutriGuide é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå°†åŠŸèƒ½æ¨¡å—åŒ–ä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œæä¾›é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ”§ æŠ€æœ¯é€‰å‹å¯¹æ¯”

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | æ›¿ä»£æ–¹æ¡ˆ | é€‰æ‹©ç†ç”± |
|------|----------|----------|----------|
| **Backend API** | NestJS + TypeScript | Express.js, Fastify | ä¼ä¸šçº§æ¡†æ¶ï¼Œè£…é¥°å™¨æ”¯æŒï¼Œå†…ç½®ä¾èµ–æ³¨å…¥ |
| **æ•°æ®åº“** | MongoDB | PostgreSQL, MySQL | æ–‡æ¡£å‹å­˜å‚¨ï¼Œé€‚åˆè¥å…»æ•°æ®çš„å¤æ‚ç»“æ„ |
| **ç¼“å­˜** | Redis | Memcached | è½»é‡çº§ï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„ |
| **å®¹å™¨åŒ–** | Docker + Compose | Kubernetes | ç®€åŒ–å¼€å‘ç¯å¢ƒï¼Œæ˜“äºéƒ¨ç½² |

## ğŸŒ æœåŠ¡é—´é€šä¿¡æ¶æ„

```mermaid
graph TB
    subgraph "Client Layer"
        A[Mobile App]
        B[iOS App]
        C[Web Dashboard]
    end

    subgraph "API Gateway"
        D[Nginx Load Balancer]
    end

    subgraph "Application Layer"
        E[Backend API<br/>NestJS]
    end

    subgraph "Data Layer"
        I[MongoDB<br/>Primary Database]
        J[Redis<br/>Cache & Session]
    end

    subgraph "Storage Layer"
        L[Logs<br/>Application Logs]
    end

    A --> D
    B --> D
    C --> D
    D --> E
    E --> I
    E --> J
    E --> L
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### 1. APIè¯·æ±‚æµç¨‹

```mermaid
sequenceDiagram
    participant U as User/App
    participant B as Backend API
    participant R as Redis Cache
    participant DB as MongoDB

    U->>B: APIè¯·æ±‚
    B->>R: æ£€æŸ¥ç¼“å­˜
    alt ç¼“å­˜å‘½ä¸­
        R->>B: è¿”å›ç¼“å­˜æ•°æ®
        B->>U: è¿”å›ç»“æœ
    else ç¼“å­˜æœªå‘½ä¸­
        B->>DB: æŸ¥è¯¢æ•°æ®åº“
        DB->>B: è¿”å›æ•°æ®
        B->>R: æ›´æ–°ç¼“å­˜
        B->>U: è¿”å›ç»“æœ
    end
```

### 2. æ•°æ®åŒæ­¥æœºåˆ¶

- **å®æ—¶å¤„ç†**: APIè¯·æ±‚å®æ—¶å“åº”
- **ç¼“å­˜ç­–ç•¥**: çƒ­ç‚¹æ•°æ®Redisç¼“å­˜
- **æ•°æ®ä¸€è‡´æ€§**: äº‹åŠ¡ä¿è¯æ•°æ®å®Œæ•´æ€§

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æˆæƒ

```mermaid
graph LR
    A[Client Request] --> B[API Gateway]
    B --> C{JWT Token Valid?}
    C -->|Yes| D[Route to Service]
    C -->|No| E[Return 401]
    D --> F[Service Authorization]
    F --> G[Business Logic]
```

### å®‰å…¨æªæ–½

1. **APIå±‚é¢**
   - JWT tokenè®¤è¯
   - Rate limiting
   - CORSé…ç½®
   - Input validation

2. **æœåŠ¡å±‚é¢**
   - æœåŠ¡é—´é€šä¿¡åŠ å¯†
   - æ–‡ä»¶ä¸Šä¼ é™åˆ¶
   - æ¶æ„æ–‡ä»¶æ£€æµ‹

3. **æ•°æ®å±‚é¢**
   - æ•°æ®åº“è¿æ¥åŠ å¯†
   - æ•æ„Ÿæ•°æ®è„±æ•
   - å®šæœŸå¤‡ä»½

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```yaml
# ç”Ÿäº§ç¯å¢ƒæ‰©å±•é…ç½®
services:
  backend:
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M
```

### è´Ÿè½½å‡è¡¡ç­–ç•¥

- **Backend API**: Round-robinè´Ÿè½½å‡è¡¡
- **æ•°æ®åº“**: è¯»å†™åˆ†ç¦» (æœªæ¥)

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ (dev)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Development               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å•æœºéƒ¨ç½²                           â”‚
â”‚ â€¢ æºç æŒ‚è½½çƒ­é‡è½½                      â”‚
â”‚ â€¢ è¯¦ç»†æ—¥å¿—è¾“å‡º                       â”‚
â”‚ â€¢ MongoDB Admin UI                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•ç¯å¢ƒ (qa)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QA Testing             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”Ÿäº§æ¨¡å¼æ„å»º                       â”‚
â”‚ â€¢ èµ„æºé™åˆ¶                          â”‚
â”‚ â€¢ æ€§èƒ½ç›‘æ§                          â”‚
â”‚ â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§ç¯å¢ƒ (prod)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Production               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å¤šå®ä¾‹éƒ¨ç½²                        â”‚
â”‚ â€¢ Nginxè´Ÿè½½å‡è¡¡                     â”‚
â”‚ â€¢ SSL/TLSåŠ å¯†                       â”‚
â”‚ â€¢ ç›‘æ§å‘Šè­¦                          â”‚
â”‚ â€¢ è‡ªåŠ¨é‡å¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

1. **åº”ç”¨å±‚ç¼“å­˜**
   - Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
   - ç”¨æˆ·ä¼šè¯ç¼“å­˜
   - APIå“åº”ç¼“å­˜

2. **æ•°æ®åº“ä¼˜åŒ–**
   - ç´¢å¼•ä¼˜åŒ–
   - æŸ¥è¯¢ä¼˜åŒ–
   - è¿æ¥æ± é…ç½®

### ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | ç›‘æ§é¡¹ | é˜ˆå€¼ |
|----------|--------|------|
| **ç³»ç»Ÿæ€§èƒ½** | CPUä½¿ç”¨ç‡ | <80% |
| **å†…å­˜ä½¿ç”¨** | å†…å­˜å ç”¨ | <85% |
| **ç½‘ç»œ** | å“åº”æ—¶é—´ | <500ms |
| **é”™è¯¯ç‡** | 5xxé”™è¯¯ | <1% |

## ğŸ”§ è¿ç»´æŒ‡å—

### æ—¥å¸¸ç»´æŠ¤

```bash
# æœåŠ¡çŠ¶æ€æ£€æŸ¥
./scripts/status.sh

# æ—¥å¿—æŸ¥çœ‹
docker-compose logs -f --tail=100 backend-api-prod

# æ€§èƒ½ç›‘æ§
docker stats

# æ¸…ç†æ— ç”¨èµ„æº
./scripts/cleanup.sh
```

### æ•…éšœæ¢å¤

1. **æœåŠ¡é‡å¯**
   ```bash
   # é‡å¯ç‰¹å®šæœåŠ¡
   docker-compose restart backend-api-prod
   ```

2. **æ•°æ®å¤‡ä»½æ¢å¤**
   ```bash
   # æ•°æ®åº“å¤‡ä»½
   docker exec mongodb-prod mongodump --out=/backup
   
   # æ•°æ®æ¢å¤
   docker exec mongodb-prod mongorestore /backup
   ```

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡ (1-3ä¸ªæœˆ)

- [ ] å¢åŠ APIåŠŸèƒ½æ¨¡å—
- [ ] å®ç°æ•°æ®åˆ†æåŠŸèƒ½
- [ ] å®Œå–„ç›‘æ§å’Œå‘Šè­¦
- [ ] æ€§èƒ½ä¼˜åŒ–

### ä¸­æœŸç›®æ ‡ (3-6ä¸ªæœˆ)

- [ ] å¾®æœåŠ¡ç½‘æ ¼ (Service Mesh)
- [ ] åˆ†å¸ƒå¼è¿½è¸ª (Distributed Tracing)
- [ ] è‡ªåŠ¨åŒ–CI/CD
- [ ] å¤šè¯­è¨€æ”¯æŒ

### é•¿æœŸç›®æ ‡ (6-12ä¸ªæœˆ)

- [ ] Kuberneteséƒ¨ç½²
- [ ] å¤šåŒºåŸŸéƒ¨ç½²
- [ ] æœºå™¨å­¦ä¹ æ¨¡å‹é›†æˆ
- [ ] å®æ—¶æ•°æ®åˆ†æ

## ğŸ“š æŠ€æœ¯å€ºåŠ¡

### å½“å‰å·²çŸ¥é—®é¢˜

1. **æ€§èƒ½ä¼˜åŒ–**
   - APIå“åº”é€Ÿåº¦æœ‰å¾…æå‡
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

2. **ç›‘æ§å®Œå–„**
   - ç¼ºå°‘åˆ†å¸ƒå¼è¿½è¸ª
   - å‘Šè­¦æœºåˆ¶éœ€è¦å®Œå–„

3. **æµ‹è¯•è¦†ç›–**
   - é›†æˆæµ‹è¯•è¦†ç›–ç‡ä¸è¶³
   - æ€§èƒ½æµ‹è¯•å¾…è¡¥å……

### è§£å†³è®¡åˆ’

- Q1: æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§å®Œå–„
- Q2: æµ‹è¯•è¦†ç›–ç‡æå‡
- Q3: æ¶æ„é‡æ„å’Œä¼˜åŒ–

---

## ğŸ“ è”ç³»æ–¹å¼

- **æ¶æ„å¸ˆ**: architecture@nutriguide.com
- **DevOps**: devops@nutriguide.com
- **æŠ€æœ¯æ”¯æŒ**: tech-support@nutriguide.com 